name: CI - Validaci√≥n de c√≥digo

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

permissions:
  contents: read

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout del repositorio
        uses: actions/checkout@v4

      - name: Configurar Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Instalar dependencias
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          pip install flake8

      - name: Validar sintaxis Python
        run: |
          echo "üîç Validando sintaxis de todos los archivos .py..."
          python -m py_compile app.py
          python -m py_compile styles.py
          python -m py_compile utils.py
          python -m py_compile contenidos.py
          python -m py_compile logros.py
          find clases -name "*.py" -exec python -m py_compile {} \;
          echo "‚úÖ Sintaxis validada correctamente"

      - name: Verificar imports
        run: |
          echo "üîç Verificando imports del proyecto..."
          python -c "
          from contenidos import CONTENIDOS
          from styles import aplicar_estilos
          from logros import registrar_clase, render_ranking
          from utils import render_proximamente, render_multiple_choice_quiz
          print('‚úÖ Todos los imports funcionan correctamente')
          print(f'   - Ejes tem√°ticos cargados: {len(CONTENIDOS)}')
          total_clases = sum(
              len(clases)
              for eje in CONTENIDOS.values()
              for clases in eje[\"subcategorias\"].values()
          )
          print(f'   - Total de clases registradas: {total_clases}')
          "

      - name: Lint - Errores cr√≠ticos
        run: |
          echo "üîç Ejecutando linter para errores cr√≠ticos..."
          flake8 . --count --select=E9,F63,F7,F82 --show-source --statistics \
            --exclude=__pycache__,.git
          echo "‚úÖ Sin errores cr√≠ticos detectados"
